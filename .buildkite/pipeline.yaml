steps:
  - name: ":python:"
    command: "ls"
  - name: "copy s3 content"
    commands: 
      - "mkdir s3"
      - "aws s3 cp s3://adarsh-code-source-bucket-2/j/ ./s3 --recursive"
  - name: "docker build"
    command: "docker build . -t adarsh-repo:latest  --build-arg AWS_ACCESS_KEY_ID --build-arg AWS_SECRET_ACCESS_KEY --build-arg AWS_SESSION_TOKEN"
  - name: "login to ecr"
    command: "aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin 853973692277.dkr.ecr.us-east-1.amazonaws.com"
  - name: "tag image"
    command: "docker tag adarsh-repo:latest 853973692277.dkr.ecr.us-east-1.amazonaws.com/adarsh-repo:latest"
  - name: "push image"
    command: "docker push 853973692277.dkr.ecr.us-east-1.amazonaws.com/adarsh-repo:latest"
  - name: "cleanup"
    commands: 
      - "docker image prune -a --force"
      - "rm -rf s3"